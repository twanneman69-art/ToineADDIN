let gRange = null; let gData = []; let gColumns = []; let gUndoStack = []; Office.onReady(() => { document.getElementById("selectRange").onclick = selectRange; document.getElementById("deleteSelected").onclick = deleteSelected; document.getElementById("deleteAuto").onclick = deleteAuto; document.getElementById("undo").onclick = undo; document.getElementById("confirm").onclick = confirm; }); async function selectRange() { await Excel.run(async context => { const cell = context.workbook.getSelectedRange(); cell.load("address"); await context.sync(); const region = cell.getSurroundingRegion(); region.load(["address", "values"]); await context.sync(); gRange = region; gData = region.values; document.getElementById("rangeInfo").innerText = "Geselecteerde lijst: " + region.address; buildColumnSelector(); findDuplicates(); }); } function buildColumnSelector() { const container = document.getElementById("columnSelector"); container.innerHTML = ""; gColumns = gData[0]; let html = "<table><tr><th>Kolom</th><th>Gebruik</th></tr>"; gColumns.forEach((col, i) => { html += ` <tr> <td>${col}</td> <td><input type="checkbox" class="colCheck" data-index="${i}"></td> </tr>`; }); html += "</table>"; container.innerHTML = html; document.querySelectorAll(".colCheck").forEach(cb => { cb.onchange = findDuplicates; }); } function findDuplicates() { const selectedCols = [...document.querySelectorAll(".colCheck")] .filter(cb => cb.checked) .map(cb => parseInt(cb.dataset.index)); if (selectedCols.length === 0) return; const rows = gData.slice(1); const map = {}; rows.forEach((row, i) => { const key = selectedCols.map(c => row[c]).join("|"); if (!map[key]) map[key] = []; map[key].push(i + 1); }); const dups = Object.values(map).filter(arr => arr.length > 1); renderDuplicates(dups); } function renderDuplicates(dups) { const container = document.getElementById("duplicates"); let html = "<table><tr><th>Selecteer</th><th>Row</th>"; gColumns.forEach(c => html += `<th>${c}</th>`); html += "</tr>"; dups.forEach(group => { group.forEach(r => { html += `<tr class="duplicateRow"> <td><input type="checkbox" class="dupRow" data-row="${r}"></td> <td>${r}</td>`; gData[r].forEach(v => html += `<td>${v}</td>`); html += "</tr>`; }); }); html += "</table>"; container.innerHTML = html; } async function deleteSelected() { const rows = [...document.querySelectorAll(".dupRow")] .filter(cb => cb.checked) .map(cb => parseInt(cb.dataset.row)); if (rows.length === 0) return; gUndoStack.push(JSON.parse(JSON.stringify(gData))); await Excel.run(async context => { rows.sort((a, b) => b - a); rows.forEach(r => { gRange.getRow(r).delete(Excel.DeleteShiftDirection.up); }); await context.sync(); }); } async function deleteAuto() { // later vullen met jouw exacte VBA-logica } async function undo() { if (gUndoStack.length === 0) return; const previous = gUndoStack.pop(); await Excel.run(async context => { gRange.values = previous; await context.sync(); }); } function confirm() { gUndoStack = []; alert("Verwijderingen bevestigd."); }